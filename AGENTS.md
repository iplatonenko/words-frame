# AGENTS.md

## Что это за проект

**Words Frame** — минималистичное PWA-табло (как фоторамка), которое:

- принимает CSV со словами
- крутит их бесконечно с заданным интервалом
- умеет shuffle
- имеет режим “табло” (полный экран без контролов)
- сохраняет слова и настройки локально
- работает **офлайн после первой загрузки** (Service Worker)
- запускается с домашнего экрана (Add to Home Screen на iOS)

Фокус: **простота, совместимость со старыми устройствами (iPad mini 1 / iOS 12.5), без фреймворков**.

## Текущий статус репо (на февраль 2026)

В репозитории уже есть базовый UI и логика в `index.html`, `styles.css`, `app.js`.
Базовая PWA-часть уже добавлена: есть `sw.js` и `manifest.webmanifest`.
Также добавлены иконки `icons/icon-192.png` и `icons/icon-512.png`.

Это означает:

- PWA-манифест и Service Worker ссылаются на реально существующие файлы;
- офлайн-кэширование ассетов может работать без битых ссылок в `ASSETS`.

## Технологии и ограничения

- Только **Vanilla HTML/CSS/JS**. Без сборщиков, React/Vue, TypeScript и зависимостей.
- Код должен быть совместим с iOS 12.5 Safari:
  - никаких современных API без проверок (`?.`, `??`, modules, etc.)
  - предпочтение `var`, обычным функциям, без class-полиморфизма
- Никаких внешних CDN/шрифтов/картинок, чтобы офлайн был стабильным.
- Разделять код по файлам: `index.html`, `styles.css`, `app.js`, `sw.js`, `manifest.webmanifest`.

## Основной UX

### Экран отображения

- Центр: слово/фраза (крупно)
- Под ним: перевод (меньше)
- Низ: панель управления (скрывается в режиме табло)

### Управление

- Загрузить CSV
- Старт / Пауза
- Назад / Вперёд
- Shuffle
- Интервал (select с пресетами)
- Режим табло:
  - скрывает панель
  - тап по экрану = следующий
  - выход из табло: **долгий тап (~900мс)** и/или **двойной тап** (резерв)

## Данные и хранение

- После импорта CSV сохранять:
  - массив слов: `localStorage["wf_words_v1"]`
  - текущий индекс: `localStorage["wf_index_v1"]`
  - интервал: `localStorage["wf_interval_v1"]`
  - флаг табло: `localStorage["wf_board_v1"]`
- При старте:
  - восстановить всё из localStorage
  - сразу показать последнюю карточку

## CSV: поддерживаемые форматы

Авто-детект разделителя: `;` или `,`.

Поддерживать структуры:

1. **2 колонки**: `KNOWN,LEARNING` (язык, который знаешь + язык, который учишь)

Поддерживать кавычки CSV (`"..."`, `""` как escape). Игнорировать пустые строки.
Заголовок автоматически не пропускается: если он есть в файле, он будет считаться обычной строкой данных.

## Офлайн (critical)

Service Worker должен кэшировать ассеты приложения:

- `./`, `./index.html`, `./styles.css`, `./app.js`, `./manifest.webmanifest`, иконки

Правило fetch:

- `cache-first`: сначала кэш, иначе сеть

Важно для обновлений:

- при изменениях ассетов **бампать версию CACHE** (например `words-frame-v1` → `words-frame-v2`).

## PWA / iOS Add to Home Screen

- `manifest.webmanifest` для нормальных браузеров
- для iOS добавить в `index.html`:
  - `apple-mobile-web-app-capable`
  - `apple-mobile-web-app-title`
  - `apple-touch-icon`
- Установка на iOS делается вручную через “Поделиться → На экран «Домой»”.

## Структура репо

- `/index.html`
- `/styles.css`
- `/app.js`
- `/sw.js`
- `/manifest.webmanifest`
- `/icons/icon-192.png`
- `/icons/icon-512.png`

## Что нужно делать агенту при задачах

1. Сначала определить, какой файл менять (HTML/CSS/JS/SW/manifest).
2. Делать минимальные изменения, без переписывания архитектуры.
3. Не добавлять новые зависимости.
4. Всегда учитывать офлайн и iOS 12 совместимость.
5. Если меняется набор файлов, кэш или пути — обновить список `ASSETS` в `sw.js` и при необходимости версию CACHE.

## Быстрый чек перед сдачей задачи

- Проверить, что `index.html` не ссылается на отсутствующие файлы.
- Если подключён `./sw.js`, убедиться, что файл реально существует и корректно регистрируется.
- Если заявлен PWA-режим, проверить наличие `manifest.webmanifest` и иконок `icons/icon-192.png`, `icons/icon-512.png`.
- Проверить, что в JS нет синтаксиса, несовместимого с iOS 12.5 (`?.`, `??`, `import`, `class fields`).
- Проверить, что после изменений не сломаны `localStorage` ключи: `wf_words_v1`, `wf_index_v1`, `wf_interval_v1`, `wf_board_v1`.

## Известные пробелы (технический долг)

- На текущий момент критичных расхождений между спецификацией и кодом не зафиксировано.

## Definition of Done

- Загруженный CSV сохраняется и крутится по кругу
- Интервал работает, старт/пауза/навигация работают
- Shuffle перемешивает порядок и сохраняется
- Режим табло скрывает контролы и имеет понятный выход
- После первой загрузки сайт открывается и работает **без Wi-Fi**
- Не ломается на iPad mini 1 (iOS 12.5 Safari)
